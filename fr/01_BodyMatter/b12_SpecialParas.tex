% * BEGIN 
%%% File:      b12_SpecialParas.mkiv
%%% Author:    Joaquín Ataz-López
%%% Begun:     July 2020
%%% Concluded: August 2020
%%% Contents:  This chapter is a big final mishmash. Everything
%%%            that could not be clearly located elsewhere, is
%%%            here. I decided on the final structure when
%%%            I was writing this chapter, since when starting
%%%            to deal with certain material I became aware
%%%            that it could be placed elsewhere.
%%%
%%% Edited: Emacs + AuTeX - And at times vim + context-plugin
%%%

\environment introCTX_env

\startcomponent b12_SpecialParas


\startchapter
  [title={Constructions et paragraphes spéciaux},
  reference=cap:specialparas]

\TocChap

% ** Section
\startsection
  [title={Notes de bas de page et de fin de document}]

Les notes sont des \quotation{éléments textuels secondaires employés à des fins diverses, comme clarifier ou prolonger le texte principal, fournir la référence bibliographique des sources, y compris les citations, renvoyer à d'autres documents ou énoncer le sens du texte}. [{\em Libro de Estilo de la Lengua española} (Guide de style de la langue espagnole), p. 195]. Elles sont particulièrement importantes dans les textes de nature académique. Elles peuvent être placés à différents endroits de la page ou du document. Aujourd'hui, les plus répandues sont celles qui sont situées en bas de page (appelées, par conséquent, notes de bas de page) ; parfois, elles sont également situées dans l'une des marges (notes de marge), à la fin de chaque chapitre ou section, ou à la fin du document (notes de fin de document). Dans les documents particulièrement complexes, il peut également y avoir différentes séries de notes : notes de l'auteur, notes du traducteur, mises à jour, etc. En particulier, dans les éditions critiques, l'appareil de notes peut devenir assez complexe et seuls quelques systèmes de composition sont capables de le supporter. \ConTeXt\ est l'un d'entre eux. De nombreuses commandes sont disponibles pour établir et configurer les différents types de notes. 

Pour expliquer cela, il est utile de commencer par indiquer les différents éléments qui peuvent être impliqués dans une note :


\startitemize

\item {\em Marque} ou note {\em ancre} : Signe placé dans le corps du texte pour indiquer qu'une note lui est associée. Tous les types de notes ne sont pas associés à une {\em ancre}, mais lorsqu'il y en a une, cette {\em ancre} apparaît à deux endroits : à l'endroit du texte principal auquel la note fait référence, et au début du texte de la note elle-même. C'est la présence de la même marque de référence à ces deux endroits qui permet d'associer la note au texte principal.

\item La note {\em ID ou identifiant} : La lettre, le chiffre ou le symbole qui identifie la note et la distingue des autres notes. Certaines notes, par exemple les notes de marge, peuvent ne pas avoir d'ID. Lorsque ce n'est pas le cas, l'identifiant coïncide normalement avec l'{\em ancre} de la note.

\startSmallPrint

Si nous pensons exclusivement aux notes de bas de page, nous ne verrons aucune différence entre ce que je viens d'appeler une {\em Marque} et l’{\em id}. Nous voyons clairement la différence dans d'autres types de notes : Les notes de ligne, par exemple, ont un id, mais pas de marque de référence.
    
\stopSmallPrint


\item {\em Texte} ou {\em Contenu} de la note, toujours situé à un endroit différent sur la page ou dans le document que la commande qui génère la note et indique son contenu.

\item {\em Étiquette} associée à la note : Étiquette ou nom associé à une note qui n'apparaît pas dans le document final, mais qui permet d'y faire référence et de retrouver son identifiant ailleurs dans le document.

\stopitemize

% *** Subsection 
\startsubsection
  [title=Le types de notes dans \ConTeXt\ et les commandes associées]

Nous disposons de différents types de notes dans \ConTeXt. Pour l'instant, je me contenterai de les énumérer, en les décrivant en termes généraux et en fournissant des informations sur les commandes qui les génèrent. Plus tard, je développerai les deux premiers~:


\startitemize

\item {\bf Notes de bas de page (footnotes)~:} Sans aucun doute la plus populaire, à tel point qu'il est courant que tous les types de notes soient désignés par le terme générique de {\em notes de bas de page}. Les notes de bas de page introduisent une {\em marque} avec l'{\em id} de la note à l'endroit du document où se trouve la commande, et insèrent le texte de la note elle-même en bas de la page où la marque apparaît. Elles sont créées avec la commande \tex{footnote}.

\item {\bf Notes de fin de document (endnotes)~:} Ces notes, créées avec la commande \tex{endnote}, sont insérées à l'endroit du document où se trouve une marque portant l'identifiant de la note ; mais le contenu de la note est inséré à un autre endroit du document, et l'insertion est produite par une commande différente (\tex{placenotes}).

\item {\bf Notes marginales (margin notes)~:} Comme leur nom l'indique, elles sont écrites dans la marge du texte et il n'y a pas d'identifiant ou de marque ou d'ancre générée automatiquement dans le corps du document. Les deux principales commandes (mais pas les seules) qui les créent sont \tex{inmargin} et \tex{margintext} (voir \in{section}[sec:margintext]).

\item {\bf Notes de ligne (line notes)~:} Type de note typique des environnements où les lignes sont numérotées, comme dans le cas de \tex{startlinenumbering ... \stoplinenumbering} (voir \in{section}[sec:linumbering]). La note, qui est généralement écrite en bas, fait référence à un numéro de ligne spécifique. Elles sont générées par la commande \PlaceMacro{linenote} \tex{linenote} qui est configurée avec \PlaceMacro{setuplinenote} \tex{setuplinenote}. Cette commande n'imprime pas de {\em marque} dans le corps du texte, mais dans la note elle-même, elle imprime le numéro de ligne auquel la note se réfère (utilisé comme {\em ID}).

\stopitemize

Je vais maintenant développer exclusivement les deux premiers types de notes~:

\startitemize

\item Les notes de marge sont traitées ailleurs (\in{section}[sec:margintext]).

\item Les notes de ligne ont un usage très spécialisé (notamment dans les éditions critiques) et je pense que dans un document d'introduction comme celui-ci, il suffit que le lecteur sache qu'elles existent.

\startSmallPrint

Cependant, pour le lecteur intéressé, je recommande une vidéo (en espagnol) accompagnée d'un texte (également en espagnol) sur les éditions critiques dans \ConTeXt, dont l'auteur est Pablo Rodríguez. Elle est disponible \goto{en ligne}[url(http://www.ediciones-criticas.tk/)]. Il est également très utile pour comprendre plusieurs des paramètres généraux des notes en général.

\stopSmallPrint

\stopitemize

\stopsubsection

% *** Subsection 
\startsubsection
  [title=Zoom les notes de bas de page et de fin de document]

\PlaceMacro{footnote}
\PlaceMacro{endnote}

La syntaxe des commandes \tex{footnotes} et \tex{endnotes} et les mécanismes de configuration et de personnalisation dont elles disposent sont assez similaires, puisque, en réalité, ces deux types de notes sont des instances particulières d'une construction plus générale (notes), dont d'autres instances peuvent être définies avec la commande \tex{definenote} (voir \in{section}[sec:definenote]).

La syntaxe de la commande qui crée chacun de ces types de notes est la suivante :

\placefigure [force,here,none] [] {}
{\startDemoI
\footnote [Étiquette] {Texte}
\endnote  [Étiquette] {Texte}
\stopDemoI}

\startitemize

\item {\em Étiquette} est un argument facultatif qui attribue à la note une étiquette qui nous permettra d'y faire référence ailleurs dans le document.

\item {\em Texte} est le contenu de la note. Il peut être aussi long que nous le souhaitons, et inclure des paragraphes et des paramètres spéciaux, bien qu'il faille noter qu'en ce qui concerne les notes de bas de page, une mise en page correcte est assez difficile dans les documents contenant des notes abondantes et excessivement longues.

\startSmallPrint

En principe, toute commande qui peut être utilisée dans le texte principal peut être utilisée dans le texte de la note. Cependant, j'ai pu vérifier que certaines constructions et caractères qui ne posent aucun problème dans le texte principal, génèrent une erreur de compilation lorsqu'ils sont utilisés dans le texte de la note. J'ai trouvé ces cas lors de mes tests, mais je ne les ai pas organisés de quelque manière que ce soit.

\stopSmallPrint

\stopitemize

Lorsque l'argument {\em Étiquette} a été utilisé pour définir une étiquette pour la note, la commande \PlaceMacro{note} \tex{note} nous permet de récupérer l'ID de la note en question. Cette commande affiche l'ID de la note associée à l'étiquette qu'elle prend en argument sur le document. Ainsi, par exemple :


\placefigure [force,here,none] [] {}
{\startDemoI
\setuppapersize[A7,landscape]
\setupbodyfont[8pt]
\starttext
Humpty Dumpty{\footnote[humpty]{probablement le personnage de comptine anglais le plus célèbre} s'est assis sur un mur, Humpty Dumpty\note[humpty] a fait une grande chute. Tous les chevaux du roi et tous les hommes du roi n'ont pas pu remettre Humpty\note[humpty] ensemble.
\stoptext
\stopDemoI}


\startbuffer[a7-testfootnoteA]
\setuppapersize[A7,landscape]
\setupbodyfont[8pt]
\starttext
Humpty Dumpty{\footnote[humpty]{probablement le personnage de comptine anglais le plus célèbre} s'est assis sur un mur, Humpty Dumpty\note[humpty] a fait une grande chute. Tous les chevaux du roi et tous les hommes du roi n'ont pas pu remettre Humpty\note[humpty] ensemble.
\stoptext
\stopbuffer

\savebuffer[list=a7-testfootnoteA,file=ex_footnoteA.tex,prefix=no]
\placefigure [force,here,none] [] {}{\typesetbuffer[a7-testfootnoteA][frame=on,page=1,background=color,backgroundcolor=white]
\attachment
  [file={ex_footnoteA.tex},
   title={exemple testfootnoteA}]}

La principale différence entre \tex{footnote} et \tex{endnote} est l'endroit où la note apparaît~:


\startdescription{\tex{footnote}}

En règle générale, il imprime le texte de la note au bas de la page sur laquelle se trouve la commande, de sorte que la marque de la note et son texte (ou le début du texte, s'il doit être réparti sur deux pages) apparaissent sur la même page. Pour ce faire, \ConTeXt\ fera les ajustements nécessaires lors de la composition de la page en calculant l'espace requis par l'emplacement de la note au bas de la page.

\startSmallPrint

% TODO Garulfo : ce n'est pas ainsi que cela fonctionne
% footnotetext c'est comme footnote, sans afficher la marque

% Mais dans certains environnements, \tex{footnote} insérera le texte de la note, non pas en bas de la page elle-même mais sous l'environnement. C'est le cas, par exemple dans l'environnement {\tt columns}. Dans ces cas, si nous voulons que les notes à l'intérieur de l'environnement soient situées en bas de la page, au lieu de \tex{footnote}, la commande que nous devons utiliser est \tex{footnotetext} en combinaison avec la commande \tex{note} mentionnée ci-dessus. La première, qui prend également en charge une étiquette comme argument facultatif, imprime uniquement le texte de la note et non la marque. Mais comme \tex{note} n'imprime que la marque sans le texte, la combinaison des deux nous permet de placer la note à l'endroit voulu. Ainsi, par exemple, nous pouvons écrire \tex{note[MonÉtiquette]} dans un tableau ou un environnement à plusieurs colonnes, puis, une fois sorti de cet environnement, \type{\footnotetext[MonÉtiquette]{texte de la note}}.

\PlaceMacro{footnotetext}
\PlaceMacro{note}

\tex{footnotetext} fait la même chose que \tex{footnote} mais sans introduire la marque localement. La marque peut-être affichée séparément avec \tex{note}, il faut pour cela passer aux deux commandes le nom de référence entre crochet \MyKey{\[MonÉtiquette\]}. Une utilisation de \tex{footnotetext} en combinaison avec \tex{note} serait des notes à l'intérieur d'autres notes. C'est ainsi qu'a été construit la référence 3 dans l'exemple suivant, où vous pouvez constater que dans un environnement \tex{startcolumns} les notes de bas de page deviennent des notes de bas de colonne~:

%-----------------------------------------

\startbuffer[a7-testfootnoteC]
\setuppapersize[A7,landscape]
\setupbodyfont[8pt]
\starttext
\startcolumns[n=2]
Une première phrase pour servir d'exemple
\footnote{Coucou 1}
\column
Une seconde phrase pour servir d'exemple
\footnote{Coucou 2} 
\footnotetext[testici]{Coucou 3} 
\note[testici]
\stopcolumns
\stoptext
\stopbuffer

\savebuffer[list=a7-testfootnoteC,file=ex_footnoteC.tex,prefix=no]
\placefigure [force,here,none] [] {}{\typesetbuffer[a7-testfootnoteC][frame=on,page=1,background=color,backgroundcolor=white]
\attachment
  [file={ex_footnoteC.tex},
   title={exemple testfootnoteC}]}

%-----------------------------------------

\placefigure [force,here,none] [] {}
{\startDemoI
Une seconde phrase pour servir d'exemple
\footnote{Coucou 2} 
\footnotetext[testici]{Coucou 3} 
\note[testici]
\stopDemoI}



\stopSmallPrint
  
\stopdescription

\startdescription{\tex{endnote}}

imprime uniquement l'ancre de la note à l'endroit du fichier source où elle se trouve. Le contenu réel de la note est inséré à un autre endroit du document à l'aide d'une autre commande, (\PlaceMacro{placenotes} \tex{placenotes[endnote]}) qui, à l'endroit où elle se trouve, insère le contenu de {\em toutes} les notes de fin de document (ou du chapitre ou de la section en question).

\stopdescription

\stopsubsection

% *** Subsection 
\startsubsection
  [
    reference=sec:localfootnotes,
    title={Notes locales},
  ]

\PlaceMacro{startlocalfootnotes} 
\PlaceMacro{placelocalfootnotes}

L'environnement \tex{startlocalfootnotes} signifie que les notes de bas de page qui y sont incluses sont considérées comme des notes {\em locales}, ce qui signifie que leur numérotation sera réinitialisée et que le contenu des notes ne sera pas automatiquement inséré avec le reste des notes, mais seulement à l'endroit du document où se trouvera la commande \tex{placelocalfootnotes}, qui peut ou non se trouver dans l'environnement.

%-----------------------------------------

\startbuffer[a7-testfootnoteB]
\setuppapersize[A7,landscape]
\setupbodyfont[8pt]
\starttext
Ceci 
\footnote{ou cela \note[noteB], si vous préférez.}%
\footnotetext[noteB]
{ou encore possiblement celle-ci \note[noteC].}
\footnotetext[noteC]{pourrait être totalement différentes.}
est une phrase avec des notes imbriquées.

\placetable{Table hors localfootnotes}
{\bTABLE[width=0.25\textwidth]
\bTR \bTD Petit A   \eTD \bTD Petit B\footnote{coucou B} \eTD \eTR
\eTABLE}

\placetable{Table encadrée par localfootnotes}
{\startlocalfootnotes
\bTABLE[width=0.25\textwidth]
\bTR \bTD Petit C   \eTD \bTD Petit D\footnote{coucou D} \eTD \eTR
\bTR \bTD[nc=2,frame=off] \placelocalfootnotes           \eTD \eTR
\eTABLE
\stoplocalfootnotes}
\stoptext
\stopbuffer

\savebuffer[list=a7-testfootnoteB,file=ex_footnoteB.tex,prefix=no]
\placefigure [force,here,none] [] {}{\typesetbuffer[a7-testfootnoteB][frame=on,page=1,background=color,backgroundcolor=white]
\attachment
  [file={ex_footnoteB.tex},
   title={exemple testfootnoteB}]}

\placefigure [force,here,none] [] {}
{\startDemoI
\placetable{Table encadrée par localfootnotes}
{\startlocalfootnotes
\bTABLE[width=0.25\textwidth]
\bTR \bTD Petit C   \eTD \bTD Petit D\footnote{coucou D} \eTD \eTR
\bTR \bTD[nc=2,frame=off] \placelocalfootnotes           \eTD \eTR
\eTABLE
\stoplocalfootnotes}
\stopDemoI}

\stopsubsection

% *** Subsection 
\startsubsection
  [
    reference=sec:definenote,
    title={Création et utilisation de types de notes personnalisées},
  ]
  \PlaceMacro{definenote}

Nous pouvons créer des types spéciaux de notes avec la commande \tex{definenote}. Cela peut être utile dans les documents complexes où il y a des notes de différents auteurs, ou à des fins différentes, pour distinguer graphiquement chacun des types de notes dans notre document au moyen d'un format différent et d'une numérotation différente.

La syntaxe de la commande \tex{definenote} est la suivante :

\placefigure [force,here,none] [] {}
{\startDemoI
\definenote[MesNotes][Modèle][Configuration]
\stopDemoI}

\startitemize

\item {\em MesNotes} est le nom que nous attribuons à notre nouveau type de note.

\item {\em Modèle} est le modèle de note qui sera utilisé initialement, soit par exemple {\tt footnote} et {\tt endnote}. Dans le premier cas, notre modèle de note fonctionnera comme des notes de bas de page, et dans le second cas, comme des notes de fin de document. Nous les définirons dans le fichier source avec la commande \tex{MesNotes} et nous utliseront \tex{placenotes[MesNotes]} (le nom que nous avons attribué à ces types de notes) à l'endriot où nous souhaitons les afficher dans le document final.


\item {\em Configuration} est un argument facultatif qui nous permet de distinguer notre nouveau type de notes de son modèle~: soit en définissant un format différent, soit un type de numérotation différent, soit les deux.

  \startSmallPrint

Selon la liste officielle des commandes \ConTeXt\ (voir \in{section}[sec:qrc-setup-fr]), les paramètres qui peuvent être fournis lors de la création du nouveau type de note sont basés sur ceux qui pourraient être fournis plus tard avec \tex{setupnote}. Cependant, comme nous le verrons bientôt, il existe en fait deux commandes possibles pour configurer les notes : \tex{setupnote} et \cmd{setupnotation} (voir \in{section}[sec:confnotes]). Je pense donc qu'il est préférable d'omettre cet argument lors de la création du type de note, puis de configurer nos nouvelles notes à l'aide des commandes appropriées. Au moins, c'est plus facile à expliquer.

  \stopSmallPrint

\stopitemize

Par exemple, pour créer un nouveau type de note appelé \quotation{MesNotesBleues} qui sera similaire aux notes de bas de page mais dont le contenu sera imprimé en gras et en bleu, nous pouvons définir ainsi~: 

\placefigure [force,here,none] [] {}
{\startDemoI
\definenote    [MesNotes]
\setupnotation [MesNotesBleues]  [color=blue, style=bf]
\stopDemoI}

Une fois créée, nous disposonss de la commande \tex{MesNotesBleues} dont la syntaxe est similaire à \tex{footnote}.

%-----------------------------------------

\startbuffer[a7-testfootnoteD]
\setuppapersize[A7,landscape]
\setupbodyfont[8pt]
\definenote[MesNotesBleues]
\setupnotation 
  [MesNotesBleues] 
  [color=blue, style=bf]
\starttext
Coucou \MesNotesBleues[refA]{coucou ici}
\placenotes[MesNotesBleues]
\stoptext
\stopbuffer

\savebuffer[list=a7-testfootnoteD,file=ex_footnoteD.tex,prefix=no]
\placefigure [force,here,none] [] {}{\typesetbuffer[a7-testfootnoteD][frame=on,page=1,background=color,backgroundcolor=white]
\attachment
  [file={ex_footnoteD.tex},
   title={exemple testfootnoteD}]}


\stopsubsection

% *** Subsection 
\startsubsection
  [title=Configurer les notes,
   ref=sec:confnotes]

\PlaceMacro{setupnote}
\PlaceMacro{setupnotation}

La configuration des notes (notes de bas de page ou de fin de page, notes créées avec \tex{definenote} et aussi notes de ligne mises en place avec \tex{linenote}) est réalisée avec deux commandes : \tex{setupnote} et \tex{setupnotation}.

\startSmallPrint 
\tex{setupnote} possède 35 options de configuration {\em directes} et 45 options supplémentaires héritées de \tex{setupframed} ; \tex{setupnotation} possède 45 options de configuration  {\em directes} et 23 autres héritées de \tex{setupcounter} \tex{setupcounter}. Comme ces options ne sont pas documentées et, bien que pour beaucoup d'entre elles nous puissions deviner leur utilité à partir de leur nom, nous devons vérifier si notre intuition est vraie ou non ; et aussi en tenant compte du fait que beaucoup de ces options permettent un certain nombre de valeurs et qu'elles doivent toutes être testées... Vous verrez que pour écrire cette explication j'ai dû faire un certain nombre de tests ; et bien que faire un test soit rapide, faire beaucoup de tests est lent et ennuyeux. J'espère donc que le lecteur m'excusera si je lui dis qu'en dehors des deux commandes de configuration générale des notes que je mentionne dans le texte principal et sur lesquelles je me concentre dans l'explication suivante, je laisserai de côté quatre autres possibilités de configuration dans l'explication :

\startitemize

\item \PlaceMacro{setupnotes} \tex{setupnotes} et \PlaceMacro{setupnotations}\tex{setupnotations} : En d'autres termes, le même nom mais au pluriel. Le wiki dit que les versions singulière et plurielle de la commande sont synonymes, et je le crois.

  \item \PlaceMacro{setupfootnotes} \tex{setupfootnotes} et \PlaceMacro{setupendnotes} \tex{setupendnotes} : Nous supposons qu'il s'agit d'applications spécifiques pour, respectivement, les notes de bas de page et les notes de fin. Il serait peut-être plus facile d'expliquer la configuration des notes sur la base de ces commandes, cependant, puisque je n'ai pas réussi à faire fonctionner la première option ({\tt numberconversion}) que j'ai essayée avec \tex{setupfootnotes}, bien que je sache que les autres options de ces commandes fonctionnent... J'étais trop paresseux pour ajouter les tests nécessaires pour inclure ces deux commandes dans l'explication aux nombreux tests que j'ai déjà dû faire pour écrire ce qui suit.\blank[small]

Mais je suis d'avis (d'après les quelques tests aléatoires que j'ai effectués) que tout ce qui fonctionne dans ces deux commandes, mais dont je laisse l'explication de côté, fonctionne également dans les commandes pour lesquelles je donne une explication.

\stopitemize

\stopSmallPrint 

La syntaxe est similaire dans les deux cas :

\placefigure [force,here,none] [] {}
{\startDemoI
\setupnote[NoteType][Configuration]
\setupnotation[NoteType][Configuration]
\stopDemoI}

% TODO Garulfo : il va falloir nettoyer pour éclaircir le propos

où {\em NoteType} fait référence au type de note que nous configurons ({\tt footnote}, {\tt endnote} ou le nom d'un type de note que nous avons nous-mêmes créé), et {\em configuration} contient les options de configuration particulières de la commande.

Le problème est que les noms de ces deux commandes n'indiquent pas clairement la différence entre elles ni ce que chacune d'elles configure ; et le fait que de nombreuses options de ces commandes ne soient pas documentées n'aide pas beaucoup non plus. Après de nombreux tests, je n'ai pas été en mesure de parvenir à une conclusion qui me permettrait de comprendre pourquoi certaines choses sont configurées avec l'une, tandis que d'autres le sont avec l'autre,\footnote{Il existe une page dans le \goto{ \ConTeXt\ wiki} [url(https://wiki.contextgarden.net/Unexpected\_behavior)] que j'ai découverte par hasard (puisqu'elle n'est pas spécifiquement dédiée aux notes), qui suggère que la différence est que \tex{setupnotation} contrôle le texte de la note à insérer, et \tex{setupnote} l'environnement de la note dans laquelle elle sera placée ( ? ) Mais ceci n'est pas cohérent avec le fait que, par exemple, la largeur du texte de la note (qui a à voir avec son {\em insertion}) est contrôlée par l'option {\tt width} de \tex{setupnote} et non par l'option \tex{setupnotation} du même nom. Ce qui est contrôlé dans ce cas c'est la largeur de l'espace pris pour afficher la marque, avant l'affichage du texte de la note.} sauf peut-être que, en raison des choix que j'ai faits pour le faire fonctionner, \tex{setupnotation} affecte toujours le texte de la note, ou l'ID qui est imprimé avec le texte de la note, alors que \tex{setupnote} a quelques options qui affectent la marque de la note insérée dans le texte principal.

Je vais maintenant essayer d'organiser ce que j'ai découvert après avoir fait quelques tests avec les différentes options des deux commandes. Je laisse de côté la plupart des options des deux commandes, car elles ne sont pas documentées et je n'ai pas pu tirer de conclusions quant à leur utilité ou aux conditions dans lesquelles elles doivent être utilisées :


\startitemize

\head {\bf ID utilisé pour la note:} Les notes sont toujours identifiées par un numéro. Ce que nous pouvons configurer ici est :

  \startitemize

  \item {\em Le premier nombre} : contrôlé par {\tt start} dans \tex{setupnotation}. Sa valeur doit être un nombre entier, que \ConTeXt\ utilise comme point de départ pour comptabiliser les notes.

  \item {\em Le système de numérotation}, qui dépend de l'option {\tt numberconversion} dans \tex{setupnotation}. Ses valeurs peuvent être :

  \startitemize [packed]

  \item {\em chiffres arabes} : {\tt n, N} ou {\tt numbers}.

  \item {\em chiffres romains} : {\tt I, R, Romannumerals, i, r, romannumerals}. Les trois premiers sont des chiffres romains en majuscules et les trois derniers en minuscules.

  \item {\em Numérotation avec des lettres} : {\tt A, Character, Characters, a, character, characters} selon que l'on souhaite que les lettres soient en majuscules (les trois premières options) ou en minuscules (le reste).

  \item {\em Numérotation avec des mots}. En d'autres termes, on écrit le mot qui désigne le nombre et ainsi, par exemple, \quote{3} devient \quote{trois}. Deux méthodes sont possibles. L'option {\tt Words} écrit les mots en majuscules et {\tt words} en minuscules.

  \item {\em Numérotation avec symboles} : on peut utiliser quatre jeux de symboles différents selon l'option choisie : {\tt set~0, set~1, set~2} o {\tt set~3}. Sur \at{page} [exemples de jeux de conversion], vous trouverez un exemple des symboles utilisés dans chacune de ces options.

  \stopitemize

\item {\em L'événement qui détermine la remise à zéro de la numérotation des notes} : Cela dépend de l'option {\tt way} dans \tex{setupnotation}. Lorsque la valeur est {\tt bytext}, toutes les notes du document seront numérotées séquentiellement sans que la numérotation soit réinitialisée. Lorsqu'elle vaut {\tt bychapter, bysection, bysubsection, etc.}, le compteur de notes sera réinitialisé chaque fois qu'un nouveau chapitre, ou nouvelle section ou sous-section est créé, tandis que lorsqu'elle vaut {\tt byblock}, la numérotation sera réinitialisée chaque fois que nous changerons de bloc dans la macrostructure du document (voir \in{section}[sec:macrostructure]). La valeur {\tt bypage} fait redémarrer le compteur de notes à chaque fois que la page est changée.

  \stopitemize

\head {\bf  Configurer la marque de la note~:}

  \startitemize

  \item Affichage ou non : Option {\tt number} dans \tex{setupnotation}.

  \item Positionnement de la marque par rapport au texte de la note : L'option {\tt alternative} dans \tex{setupnotation} : elle peut prendre l'une des valeurs suivantes : {\tt left, inleft, leftmargin, right, inright, rightmargin, inmargin, margin, innermargin, outermargin, serried, hanging, top, command}. Par défaut la marque est dans l'espace entre la marge et le texte. Avec {\tt hanging}
la marque est intégré dans la zone de texte, de même avec {\tt serried} qui en plus intégre une identation lors des retours à la ligne du texte de la note .

  \item Style et couleur à appliquer à la marque dans le corps du texte : L'option {\tt textstyle} et {\tt textcolor} dans \tex{setupnote}.

  \item Style et couleur à appliquer à la marque dans la note elle-même : L'option {\tt headstyle} et {\tt headcolor} dans \tex{setupnotation}.
  
  \item Commande à appliquer à la marque dans le corps du texte : L'option {\tt textcommand} dans \tex{setupnote}.

  \item Commande à appliquer à la marque dans la note elle-même : L'option {\tt numbercommand} dans \tex{setupnotation}.
   
\startSmallPrint
      
Les options {\tt numbercommand} et {\tt textcommand} doivent consister en une commande qui prend le contenu de la marque comme argument. Il peut s'agir d'une commande auto-définie. Cependant, j'ai constaté que les commandes de formatage simples (\tex{bf}, \tex{it}, etc.) fonctionnent, bien qu'elles ne soient pas des commandes devant prendre un argument.

\stopSmallPrint

\item Distance entre la marque et le texte (dans la note elle-même) : l'option {\tt distance} dans \tex{setupnotation}. Elle est complétée par l'option {\tt width} qui indique la largeur à accorder à l'affichage de la marque elle-même.

\item Existence ou non d'un lien hypertexte permettant de sauter entre la marque dans le texte principal et la marque dans la note elle-même : L'option {\tt interaction} dans \tex{setupnote}. Avec {\tt yes} comme valeur, il y aura un lien, et avec {\tt no} il n'y en aura pas.

\stopitemize

\head {\bf Configuration du texte de la note elle-même.}
   Nous pouvons influencer les aspects suivants~:

  \startitemize

  \item Positionnement : cela dépend de l'option {\tt location} dans \tex{setupnote}. 

    \startSmallPrint
      
En principe, nous savons déjà que les notes de bas de page sont placées en bas de la page ({\tt location=page}) et les notes de fin de page au point où la commande \tex{placenotes[endnote]} ({\tt location=text}) est trouvée. ({\tt location=text}), mais nous pouvons ajuster cette fonction et définir les notes de bas de page, par exemple, en tant que {\tt location=text}. Les notes de bas de page fonctionneront alors de la même manière que les notes de fin de document et apparaîtront à l'endroit du document où se trouve la commande \tex{placenotes[footnote]}, ou la commande spécifique aux notes de bas de page \tex{placefootnotes}. Avec cette procédure, nous pourrions, par exemple, imprimer les notes sous le paragraphe dans lequel elles se trouvent.

    \stopSmallPrint


  \item Séparation des paragraphes entre les notes : par défaut, chaque note est imprimée dans son propre paragraphe, mais on peut faire en sorte que toutes les notes d'une même page soient imprimées dans le même paragraphe en définissant l'option {\tt paragraph} de \tex{setupnote} sur \MyKey{yes}. 

  \item Style et couleur dans lequel le texte de la note sera écrit : l'option {\tt style} et {\tt color} dans \tex{setupnotation}.

  \item Taille de la lettre : l'option {\tt bodyfont} dans \tex{setupnote}.

    \startSmallPrint

Cette option ne concerne que le cas où l'on souhaite définir manuellement une taille de police pour les notes de bas de page. Ce n'est presque jamais une bonne idée de le faire car, par défaut, \ConTeXt\ ajuste la taille de la police des notes de bas de page pour qu'elle soit plus petite que celle du texte principal, mais avec une taille {\em proportionnelle} à celle de la police du corps principal.

    \stopSmallPrint

\item Marge gauche pour le texte de la note : l'option {\tt margin} dans \tex{setupnotation}.

  \item Largeur maximale : l'option {\tt width} dans \tex{setupnote}.

  \item Nombre de colonnes : l'option {\tt n} de \tex{setupnote} détermine si le texte de la note sera sur deux colonnes ou plus. La valeur \quote{n} doit être un nombre entier.

\stopitemize


\head {\bf Espace entre les notes ou entre les notes et le texte~:} ici, nous avons les options suivantes :
 
\startitemize
 
\item {\tt rule}, dans \tex{setupnote} détermine s'il y aura ou non une ligne (règle) entre la zone des notes et la zone de la page contenant le texte principal. Ses valeurs possibles sont {\tt yes, on, no} et {\tt off}. Les deux premières valeurs activent la règle et la dernière la désactive. Il est possible de configurer la ligne plus précisément en indiquant {\tt rule=command} et en définisant {\tt rulecommand} par exemple 

\placefigure [force,here,none] [] {}
{\startDemoI
rule=command,
rulecommand={\blackrule[width=0.5\textwidth,color=green,height=3pt,depth=-2pt]},
\stopDemoI}
 
  \item {\tt before}, dans \tex{setupnotation} : commande ou commandes à exécuter avant l'insertion du texte de la note. Sert à insérer un espacement supplémentaire, des lignes de séparation entre les notes, etc.
 
   \item {\tt after}, dans \tex{setupnotation} : commande ou commandes à exécuter après l'insertion du texte de la note.
 
 \stopitemize

\stopitemize

Finissons par un exemple~:

\startbuffer[a7-testfootnoteE]
\setuppapersize[A7,landscape]
\setupbodyfont[8pt]
%\showframe
%\showboxes
\definenote    [MesNotesBleuesA]

\setupnotation [MesNotesBleuesA]
  [color=middleblue,
   style=bf,
   headcolor=middlecyan,
   way=bypage,
   align=flushleft,
   alternative=hanging,
   width=broad,
   distance=0.5cm,
   numberconversion=Words,
   width=1.5cm,]

\setupnote     [MesNotesBleuesA]
  [textcolor=middlered,
   textstyle=it,
   rule=command,
   rulecommand={\blackrule[width=0.5\textwidth,color=middlegreen,height=3pt,depth=-2pt]},
   width=5cm,]

\definenote [MesNotesBleuesB] [MesNotesBleuesA] [alternative=inleft,textcolor=middleyellow]

\setupnotation [MesNotesBleuesB]
  [headcolor=middlemagenta,
   alternative=serried,]

\starttext
Ce début de phrase \MesNotesBleuesA[refA]{coucou ici ceci est une note de bas de page qui s'étend tout au long de la page} est suivi d'une fin de phrase \MesNotesBleuesB[refB]{coucou là ceci est une note de bas de page qui s'étend tout au long de la page}.
\stoptext
\stopbuffer

\savebuffer[list=a7-testfootnoteE,file=ex_footnoteE.tex,prefix=no]
\placefigure [force,here,none] [] {}{\typesetbuffer[a7-testfootnoteE][frame=on,page=1,background=color,backgroundcolor=white]
\attachment
  [file={ex_footnoteE.tex},
   title={exemple testfootnoteE}]}



\stopsubsection

% *** Subsection 
\startsubsection
  [title={Exclusion temporaire des notes lors de la compilation}]

\PlaceMacro{notesenabledfalse}
\PlaceMacro{notesenabledtrue}


Les commandes \tex{notesenabledfalse} et \tex{notesenabledtrue} indiquent à \ConTeXt\ d'activer ou de désactiver la compilation des notes respectivement. Cette fonction peut être utile si l'on souhaite obtenir une version sans notes lorsque le document comporte des notes nombreuses et étendues. Dans mon expérience personnelle, par exemple, lorsque je corrige une thèse de doctorat, je préfère la lire une première fois en une seule fois, sans les notes, puis faire une seconde lecture avec les notes incorporées.

\stopsubsection

\stopsection

% ** Section
\startsection
  [
    reference=sec:multiplecolumns,
    title={Paragraphes avec plusieurs colonnes},
  ]

La composition du texte peut être effectuée en plusieurs colonnes~:


\startitemize[a]

\item Comme une caractéristique générale de la mise en page.

\item Comme une caractéristique de certaines constructions telles que, par exemple, les listes structurées, les notes de bas de page ou les notes de fin de document.

\item Comme une caractéristique appliquée à des paragraphes particuliers d'un document.

\stopitemize
 
Dans tous ces cas, la plupart des commandes et des environnements fonctionneront parfaitement même si nous travaillons avec plus d'une colonne. Il existe cependant quelques limitations, principalement en ce qui concerne les objets flottants en général (voir \in{section}[sec:floating objects]) et avec les tableaux en particulier (\in{section}[sec:tables]) même s'ils ne sont pas flottants.

En ce qui concerne le nombre de colonnes autorisées, \ConTeXt\ n'a pas de limite théorique. Cependant, il existe des limites physiques qui doivent être prises en compte :

\startitemize

\item la largeur du papier : un nombre illimité de colonnes nécessite une largeur illimitée de papier (si le document est destiné à être imprimé) ou d'écran (s'il s'agit d'un document destiné à être affiché sur écran). En pratique, compte tenu de la largeur {\em normale} des formats de papier commercialisés et utilisés pour composer les livres, et des écrans des appareils informatiques, il est difficile qu'un texte soit composé selon plus de quatre ou cinq colonnes.

\item la taille de la mémoire de l'ordinateur : le manuel de référence de  \ConTeXt\ indique que, sur des systèmes  {\em normaux} (ni particulièrement puissants, ni particulièrement limités en ressources), il est possible de gérer entre 20 et 40 colonnes.

\stopitemize

Dans cette section, je me concentrerai sur l'utilisation du mécanisme multi-colonnes dans les paragraphes ou fragments spéciaux, car

\startitemize

\item Les colonnes multiples comme option de mise en page ont déjà été abordées (dans la \in{sous-section}[sec:pages-columns] de la \in{section}[sec:pages-other-matters]).

\item La possibilité offerte par certaines constructions, telles que les listes structurées ou les notes de bas de page, de composer du texte sur plus d'une colonne, est discutée en fonction de la construction ou de l'environnement en question.

\stopitemize



% *** Subsection 
\startsubsection
  [title={L'environnement \tex{startcolumns}}]

\PlaceMacro{startcolumns}

La procédure normale pour insérer des parties de texte composées en plusieurs colonnes consiste à utiliser l'environnement {\tt columns} dont le format est :

\placefigure [force,here,none] [] {}
{\startDemoI
\startcolumns[Configuration] ... \stopcolumns
\stopDemoI}

où {\em Configuration} nous permet de contrôler de nombreux aspects de l'environnement. Nous pouvons indiquer la configuration désirée à chaque fois que nous appelons l'environnement, ou adapter le fonctionnement par défaut de l'environnement pour tous les appels à l'environnement, ce dernier point pouvant être réalisé avec 

\PlaceMacro{setupcolumns}
\placefigure [force,here,none] [] {}
{\startDemoI
\setupcolumns[Configuration]
\stopDemoI}

Dans les deux cas, les options de configuration sont les mêmes. Les plus importantes, classées selon leur fonction, sont les suivantes :

\startitemize

\item {\bf Options permettant de contrôler le nombre de colonnes et l'espace entre elles~:}

  \startitemize
    
\item {\tt n} : contrôle le nombre de colonnes. Si cette option est omise, deux colonnes seront générées.

  \item {\tt nleft, nright} : ces options sont utilisées dans la mise en page de documents recto-verso (voir \in{subsection}[sec:double-sided] de \in{section}[sec:pages-autres-matières]), pour établir le nombre de colonnes sur les pages de gauche (paires) et de droite (impaires) respectivement.

  \item {\tt distance} : espace entre les colonnes.

  \item {\tt separator} : détermine ce qui marque la séparation entre les colonnes. Il peut s'agir de {\tt espace} (valeur par défaut) ou {\tt rule}, auquel cas une ligne (règle) sera générée entre les colonnes. Dans le cas où une règle est établie entre les colonnes, cette règle peut à son tour être configurée avec les deux options suivantes :

    \startitemize
      
    \item {\tt rulecolor} : couleur du trait.

    \item {\tt rulethickness} : épaisseur du trait.

    \stopitemize

  \item {\tt maxwidth}: Largeur maximale que peuvent avoir les colonnes + l'espace entre elles.

  \stopitemize

\item {\bf Options qui contrôlent la distribution du texte entre les colonnes~:}

  \startitemize

\item {\tt balance} : par défaut, \ConTeXt {\em équilibre (balance)} les colonnes, c'est-à-dire qu'il répartit le texte entre elles afin qu'elles aient plus ou moins la même quantité de texte. Cependant, nous pouvons définir cette option avec l'option \quotation{\tt no} : le texte ne commencera pas dans une colonne tant que la précédente ne sera pas pleine.

  \item {\tt direction} : détermine dans quel sens le texte est réparti entre les colonnes. Par défaut, l'ordre de lecture naturel est suivi (de gauche à droite), mais si vous donnez à cette option la valeur {\tt reverse}, l'ordre de lecture sera de droite à gauche.

  \stopitemize
  
\head {\bf Options affectant la composition du texte dans l'environnement~:}

  \startitemize

\item {\tt tolerance} : un texte écrit sur plus d'une colonne signifie que la largeur de ligne à l'intérieur d'une colonne est plus petite, et comme expliqué lors de la description du mécanisme utilisé par \ConTeXt\ pour construire les lignes (\in{section}[sec:lines]), cela rend difficile la localisation des points optimaux pour insérer les sauts de ligne. Cette option nous permet de modifier temporairement la tolérance horizontale d'un environnement (voir \in{section}[sec:horizontaltolerance]), afin de faciliter la composition du texte et éviter les débordements.

    \item {\tt align} : contrôle l'alignement horizontal des lignes dans l'environnement. Il peut prendre l'une des valeurs suivantes : {\tt right, flushright, left, flushleft, inner, flushinner, outer, flushouter, middle} ou {\tt broad}. Pour connaître la signification de ces options, voir \in{section}[sec:setupalign].

    \item {\tt color} : spécifie le nom de la couleur dans laquelle le texte de l'environnement sera écrit.

  \stopitemize

\stopitemize

Parfois, pour positionner les flottants (des tableaux, des images, voir \in{section}[cap:floats]) dans un contexte de composition en colonne, dans le cas où ces flottants couvrent toute la largeur des colonnes, il est préférable de commencer par quitter l'environnement columns avec \tex{stopcolumns}, de positionner le flottant avec par exemple avec \tex{startplacefigure}, et de reprendre ensuite avec \tex{stopplacefigure} puis  \tex{startcolumns}.

\stopsubsection

% *** Subsection 
\startsubsection
  [title={Paragraphes parallèles}]

\PlaceMacro{defineparagraphs}
\PlaceMacro{setupparagraphs}

Une version spécifique de la composition en plusieurs colonnes met en parallèle les paragraphes.  Dans ce type de construction, le texte est réparti sur deux colonnes (généralement, mais parfois plus de deux), mais il n'est pas autorisé à circuler librement entre elles, et garde au contraire un contrôle strict sur ce qui apparaîtra dans chaque colonne. Ceci est très utile, par exemple, pour générer des documents qui mettent en contraste deux versions d'un texte, comme la nouvelle et l'ancienne version d'une loi récemment modifiée, ou dans des éditions bilingues ; ou encore pour rédiger des glossaires pour des définitions de textes spécifiques où le texte à définir apparaît à gauche et la définition à droite, etc.

Normalement, nous utiliserions le mécanisme de table pour traiter ce type de paragraphes, mais cela est dû au fait que la plupart des processeurs de texte ne sont pas aussi puissants que \ConTeXt\ qui possède les commandes \tex{defineparagraphs} et \tex{setupparagraphs} qui construisent ce type de paragraphe en utilisant le mécanisme de colonne, qui, bien qu'il ait des limites, est plus flexible que le mécanisme de table.

\startSmallPrint

  Pour autant que je sache, ces paragraphes n'ont pas de nom particulier. Je les ai appelés \quotation{Paragraphes parallèles} parce que cela me semble être un terme plus descriptif que celui que \ConTeXt\ utilise pour s'y référer : \quotation{paragraphes}.

\stopSmallPrint

Les commandes de base ici sont \tex{defineparagraphs} et  \tex{setupparagraphs}  dont la syntaxe est :


\placefigure [force,here,none] [] {}
{\startDemoI
\defineparagraphs[Nom][Configuration]}
\setupparagraphs[Nom] [NumColonne][Configuration]}
\stopDemoI}

où {\em Nom} est le nom donné au nouvel environnement en question, {\em NumColonne} est un argument facultatif permettant de configurer une colonne particulière, et {\em Configuration} permet de déterminer son fonctionnement pratique. Par exemple~:

\placefigure [force,here,none] [] {}
{\startDemoHN
\defineparagraphs [MonTrio]      [n=3, before={\blank},after={\blank}]

\setupparagraphs  [MonTrio] [1]  [width=.1\textwidth, style=bold]
\setupparagraphs  [MonTrio] [2]  [width=.4\textwidth]

\startMonTrio
825
\MonTrio
Fondation de la ville de Murcie.
\MonTrio
Les origines de la ville de Murcie sont incertaines, mais il est prouvé qu'il a été ordonné de la fonder sous le nom de Madina (ou Medina) en l'an 825 par l'émir d'al-Àndalus Abderramán II,  probablement sur un établissement beaucoup plus ancien.
\stopMonTrio
\stopDemoHN}

Le fragment ci-dessus crée un environnement à trois colonnes appelé \MyKey{MonTrio}, puis configure la première colonne pour qu'elle occupe 10\% de la largeur de la ligne et soit écrite en gras, et configure la deuxième colonne pour qu'elle occupe 40\% de la largeur de la ligne. Comme la troisième colonne n'est pas configurée, elle aura la largeur restante, c'est-à-dire 50\%. Une fois l'environnement créé et configuré, nous pouvons l'utilisons.

Si nous voulions continuer à raconter l'histoire de Murcie, une nouvelle instance de l'environnement (\tex{startMonTrio}) serait nécessaire pour l'événement suivant, car il n'est pas possible d'inclure plusieurs {\em rangées} avec ce mécanisme. 

De l'exemple qui vient d'être donné, je voudrais souligner les détails suivants :

\startitemize

\item Une fois l'environnement créé avec, par exemple, \tex{defineparagraphes[MaryPoppins]}, celui-ci devient un environnement normal qui commence par \tex{startMaryPoppins} et se termine par \tex{stopMaryPoppins}.

\item Une commande \tex{MaryPoppins} est également créée, utilisée dans l'environnement pour indiquer quand changer de colonne.

\stopitemize

En ce qui concerne les options de configuration des paragraphes parallèles (\tex{setupparagraphs}), je comprends qu'à ce stade de l'introduction, et compte tenu de l'exemple qui vient d'être donné, le lecteur est déjà prêt à comprendre l'objectif de chacune des options, et je me contenterai donc d'indiquer ci-dessous le nom et le type des options et, le cas échéant, les valeurs possibles. N'oubliez pas, cependant, que \tex{setupparagraphs [Nom] [Configuration]} établit des configurations qui affectent tout l'environnement, tandis que \tex{setupparagraphs [Nom] [NumColonne] [Configuration]} applique des configurations exclusivement à la colonne indiquée.

\startitemize[columns, three, packed]\switchtobodyfont[small]
 
\item {\tt n}: Nombre de colonne

\item {\tt before}: Commande à éxécuter avant l'environnement

\item {\tt after}: Commande à éxécuter après l'environnement

\item {\tt width}: Dimension, largeur de la colonne

\item {\tt distance}: Dimension, distance entre les colonnes

\item {\tt align}: Similaire à \tex{setupalign}

\item {\tt inner}: Commande

\item {\tt rule}: on off

\item {\tt rulethickness}: Dimension, épaisseur du trait de séparation

\item {\tt rulecolor}: Couleur  du trait

\item {\tt style}: Style à appliquer au texte 

\item {\tt color}: Couleur à appliquer au texte 

\stopitemize

\startSmallPrint

La liste des options ci-dessus n'est pas complète ; j'ai exclu de la liste des options celles que je n'expliquerais pas normalement ici. J'ai également profité du fait que nous nous trouvions dans la section consacrée aux colonnes pour afficher la liste des options en triple colonne, bien que je ne l'aie pas fait avec l'une des commandes expliquées dans cette section, mais avec l'option {\tt columns} de l'environnement {\tt itemize}, auquel la section suivante est consacrée.

\stopSmallPrint

\stopsubsection

\stopsection

% ** Section
\startsection
  [
    reference=sec:itemize,
    title={Listes structurées},
  ]

Lorsque les informations sont présentées de manière ordonnée, elles sont plus faciles à saisir pour le lecteur. Mais si l'agencement est également perceptible visuellement, cela souligne pour le lecteur le fait que nous avons ici un texte structuré. C'est pourquoi il existe certaines {\em constructions} ou {\em mécanismes} qui tentent de mettre en évidence la disposition visuelle du texte, contribuant ainsi à sa structuration. Parmi les outils que \ConTeXt\ met à la disposition de l'auteur à cette fin, le plus important, qui fait l'objet de cette section, est l'environnement {\tt itemize} qui permet de développer ce que nous pourrions appeler des {\em listes structurées}.

Les listes sont des séquences d'{\em éléments de texte} (que j'appellerai {\em items}), chacun d'entre eux étant précédé d'un caractère qui permet de le mettre en évidence en le différenciant du reste, et que j'appellerai le \quotation{séparateur}. Le séparateur peut être un chiffre, une lettre ou un symbole. Généralement (mais pas toujours), les {\em items} sont des paragraphes et la liste est formatée de manière à assurer la  {\em visibilité} du séparateur pour chaque élément, généralement en appliquant un retrait suspendu qui le met en évidence. 
\footnote{En typographie, un retrait qui s'applique à toutes les lignes d'un paragraphe sauf la première est appelé un {\em tiret suspendu}, ce qui permet de trouver facilement le premier mot ou caractère du paragraphe.}
Dans le cas de listes imbriquées, l'indentation de chacune d'elles augmente progressivement. Le langage HTML appelle généralement les listes où le séparateur est un nombre ou un caractère qui augmente de manière séquentielle, des {\em listes ordonnées}, ce qui signifie que chaque {\em item} de la liste aura un séparateur différent qui nous permettra de nous référer à chaque élément par son numéro ou son identifiant ; et il donne le nom de {\em listes non ordonnées} à celles où le même caractère ou symbole est utilisé pour chaque élément de la liste.

\ConTeXt\ gère automatiquement la numérotation ou l'ordre alphabétique du séparateur dans les listes numérotées, ainsi que l'indentation que doivent avoir les listes imbriquées ; et, dans le cas de listes non ordonnées imbriquées, il s'occupe également de la sélection d'un caractère ou d'un symbole différent qui permet de distinguer d'un coup d'œil le niveau d'un {\em item} dans la liste en fonction du symbole qui le précède.


\startSmallPrint

Le manuel de référence dit que le niveau maximum d'imbrication dans les listes est de 4, mais je suppose que c'était le cas en 2013, lorsque le manuel a été écrit. D'après mes tests, il ne semble pas y avoir de limite à l'imbrication des listes {\em ordonnées} (dans mes tests, j'ai atteint jusqu'à 15 niveaux d'imbrication). Pour les listes non ordonnées, il ne semble pas y avoir de limite non plus, dans le sens où peu importe le nombre d'imbrications que nous incluons, aucune erreur ne sera générée ; mais, pour les listes non ordonnées, \ConTeXt\ applique seulement des symboles par défaut pour les neuf premiers niveaux d'imbrication. 

Quoi qu'il en soit, il convient de souligner qu'un nombre excessif d'imbrications de listes peut avoir l'effet inverse de celui recherché, à savoir que le lecteur se sent perdu, incapable de situer chaque élément dans la structure générale de la liste. C'est pourquoi je pense personnellement que, bien que les listes soient un outil puissant pour structurer un texte, il n'est presque jamais bon de dépasser le troisième niveau d'imbrication ; et même le troisième niveau ne devrait être utilisé que dans certains cas où nous pouvons le justifier.

\stopSmallPrint

L'outil général pour écrire des listes dans \ConTeXt\ est l'environnement \tex{itemize} dont la syntaxe est la suivante :

The general tool for writing lists in \ConTeXt\ is the \tex{itemize} environment whose syntax is as follows:

\PlaceMacro{startitemize}
\placefigure [force,here,none] [] {}
{\startDemoI
\startitemize[Options][Configuration] ... \stopitemize
\stopDemoI}

où les deux arguments sont facultatifs. Le premier permet d'utiliser des noms symboliques comme contenu auquel une signification précise a été attribuée par \ConTeXt\ ; le second argument, rarement utilisé, permet d'attribuer des valeurs spécifiques à certaines variables qui affectent le fonctionnement de l'environnement.

% *** Subsection 
\startsubsection
  [
    reference=sec:itemize_select-list-type,
    title={Sélection du type de liste et du séparateur entre les {\em items} de la liste},
  ]

% **** Subsubsection
\startsubsubsection
  [title={Listes non ordonnées}]

Par défaut, la liste générée par {\tt itemize} est une liste non ordonnée, dans laquelle le séparateur sera automatiquement sélectionné en fonction du niveau d'imbrication :

\startitemize[packed, columns, two]\switchtobodyfont[small]
\sym{\convertnumber{set 0}{1}} Pour le premier niveau d'imbrication.
\sym{\convertnumber{set 0}{2}} Pour le second niveau d'imbrication.
\sym{\convertnumber{set 0}{3}} Pour le troisième niveau d'imbrication.
\sym{\convertnumber{set 0}{4}} Pour le quatrième niveau d'imbrication.
\sym{\convertnumber{set 0}{5}} Pour le cinquième niveau d'imbrication.
\sym{\convertnumber{set 0}{6}} Pour le sixième niveau d'imbrication.
\sym{\convertnumber{set 0}{7}} Pour le septième niveau d'imbrication.
\sym{\convertnumber{set 0}{8}} Pour le huitième niveau d'imbrication.
\sym{\convertnumber{set 0}{9}} Pour le neuvième niveau d'imbrication.

\stopitemize

Cependant, nous pouvons indiquer expressément que nous voulons que le symbole associé à un niveau particulier soit utilisé, simplement en passant le numéro du niveau comme argument. Ainsi, \tex{startitemize[4]} générera une liste non ordonnée dans laquelle le caractère \triangleright, sera utilisé comme séparateur, quel que soit le niveau d'imbrication de la liste.

Nous pouvons également modifier le symbole prédéterminé pour chaque niveau avec \PlaceMacro{definesymbol} \tex{definesymbol} :

\placefigure [force,here,none] [] {}
{\startDemoHN
% definesymbol
%  [Level]
%  [Symbol associated with the level]
\definesymbol [symA] [\diamond]
\definesymbol [symB] [{\blackrule[height=1.3ex, width=0.9ex, depth=-0.4ex,]}] 
\setupitemize [1]    [packed] [color=middlegreen, symbol=symA]
\setupitemize [2]    [packed] [color=middlered,   symbol=symB]
\startitemize
\item Texte 1  \item Texte 2
\startitemize  \item Texte 3 \item Texte 4 \stopitemize
\item Texte 5
\stopitemize
\stopDemoHN}

\stopsubsubsection

% **** Subsubsection
\startsubsubsection
  [title=Listes ordonnées]

Pour générer une liste ordonnée, nous devons indiquer à {\tt itemize} le type d'ordre que nous voulons. Cela peut être~:

\startitemize[intro, packed, 2*broad, columns, three]
\switchtobodyfont[small]

\sym{{\bf n}} 1, 2, 3, 4, ...

\sym{{\bf m}} {\switchtobodyfont[antykwa]1, 2, 3, 4, ...}

\sym{{\bf g}} \alpha, \beta, \gamma, \delta, ...

\sym{{\bf G}} \Alpha, \Beta, \Gamma, \Delta, ...

\sym{{\bf a}} a, b, c, d, ...

\sym{{\bf A}} A, B, C, D, ...

\sym{{\bf KA}} \cap{a, b, c, d, ...}

\sym{}

\sym{{\bf r}} i, ii, iii, iv, ...

\sym{{\bf R}} I, II, III, IV, ...

\sym{{\bf KR}} \cap{i, ii, iii, iv, ...}

\stopitemize

La différence entre {\tt n} et {\tt m} réside dans la police utilisée pour représenter le nombre : {\tt n} utilise la police activée à ce moment-là, tandis que {\tt m} utilise une police différente, plus élégante, presque calligraphique.

\startSmallPrint

Je ne connais pas le nom de la police que {\tt m} utilise, et donc dans la liste ci-dessus je n'ai pas pu représenter exactement le type de chiffres que cette option génère. Je suggère aux lecteurs de la tester par eux-mêmes.

\stopSmallPrint

\stopsubsubsection

\stopsubsection

% *** Subsection 
\startsubsection
  [
    reference=sec:itemize_item-type,
    title={Saisie des éléments d'une liste},
  ]

En règle générale, les éléments d'une liste créée avec \tex{startitemize} sont saisis avec la commande \PlaceMacro{item}\tex{item} qui possède également une version sous forme d'environnement plus adaptée au style Mark~IV :
\PlaceMacro{startitem} \tex{startitem ... \stopitem}. Ainsi, observez l'exemple suivant :

\placefigure [force,here,none] [] {}
{\startDemoVN
\startitemize[a, packed]
\startitem Premier élément \stopitem
\startitem Second élément \stopitem
\startitem Troisième élément \stopitem
\stopitemize

\startitemize[a, packed]
\item Premier élément
\item Second élément
\item Troisième élément
\stopitemize
\stopDemoVN}

\tex{item} ou \tex{startitem} est la commande {\em générale} pour insérer un élément dans la liste. Elle s'accompagne des commandes supplémentaires suivantes pour obtenir un résultat particulier :


\startitemize[3*broad]

\sym{\PlaceMacro{head}\tex{head}} Cette commande doit être utilisée à la place de \tex{item} lorsque l'on veut éviter d'insérer un saut de page après l'élément en question. Son formatage peut être indiqué avec l'option {\tt headstyle=}  (bold par exemple).

\startSmallPrint

Une construction courante consiste à inclure une liste imbriquée ou un bloc de texte immédiatement sous un élément de liste, de sorte que l'élément de liste fonctionne, en un sens, comme le {\em titre} de la sous-liste ou du bloc de texte. Dans ce cas, il est déconseillé d'insérer un saut de page entre cet élément et les paragraphes suivants. Si nous utilisons \tex{head} au lieu de \tex{item} pour saisir ces éléments, \ConTeXt\ {\em s'efforcera} (dans la mesure du possible) de ne pas séparer cet élément du bloc suivant.

\stopSmallPrint

\sym{\PlaceMacro{nop}\tex{nop}} annule l'affichage du séparateur. 

\sym{\PlaceMacro{sym}\tex{sym}} La commande \type{\sym{Texte}} permet de saisir un élément dans lequel le texte utilisé comme argument de \tex{sym} est utilisé comme {\em séparateur}, et non comme nombre ou symbole. Cette liste, par exemple, est construite avec des éléments saisis au moyen de \tex{sym} au lieu de \tex{item}. 

\placefigure [force,here,none] [] {}
{\startDemoVN
\startitemize[a, packed]
\item Premier élément
\sym{x} Second élément
\nop Troisième élément
\stopitemize
\stopDemoVN}

\sym{\PlaceMacro{sub}\tex{sub}} Cette commande, qui ne doit être utilisée que dans les listes ordonnées (où chaque élément est précédé d'un numéro ou d'une lettre dans l'ordre alphabétique), fait en sorte que l'élément saisi avec elle conserve le numéro de l'élément précédent et, afin d'indiquer que le numéro est répété et qu'il ne s'agit pas d'une erreur, le signe \quote{+} est imprimé à gauche. Cela peut être utile si l'on se réfère à une liste antérieure pour laquelle on suggère des modifications mais où, pour des raisons de clarté, il convient de conserver la numérotation de la liste originale.

\sym{\PlaceMacro{mar}\tex{mar}} Cette commande conserve la numérotation des éléments, mais ajoute une lettre ou un caractère dans la marge (qui lui est passé en argument, entre crochets). Je ne suis pas sûr de son utilité.

% TODO Garulfo vérifier la compréhension de mar et sub 

\placefigure [force,here,none] [] {}
{\startDemoVN
\startnarrower[left]
\startitemize[n, packed]
\item Premier élément
\mar{o} Second élément (un o en marge)
\sub  Second élément
\item Troisième élément
\stopitemize
\stopnarrower
\stopDemoVN}

\stopitemize

Il existe deux commandes supplémentaires pour la saisie d'éléments, dont la combinaison produit des effets très {\em intéressants} et, si je peux me permettre, je pense qu'il est préférable de les expliquer par un exemple. \PlaceMacro{ran} \tex{ran} (abréviation de {\em gamme}) et \PlaceMacro{its} \tex{its}, abréviation de {\em items}. La première prend un argument (entre crochets) et la seconde répète le symbole utilisé comme séparateur dans la liste un nombre x de fois (par défaut 4 fois, mais nous pouvons modifier cela en utilisant l'option {\tt items}). L'exemple suivant montre comment ces deux commandes peuvent fonctionner ensemble pour créer une liste qui imite un questionnaire :


\placefigure [force,here,none] [] {}
{\startDemoHN
Après avoir lu l'introduction suivante, répondez aux questions suivantes~:
\startitemize[5, packed][width=8em, distance=2em, items=5]
\ran{No \hss Yes} % \hss = un espace infiniment extensible et écrasable
\its Je n'utiliserai jamais ConTeXt, c'est trop difficile.
\its Je ne l'utiliserai que pour écrire de gros livres.
\its Je l'utiliserai toujours.
\its Je l'aime tellement que j'appellerai mon prochain enfant \quotation{Hans}, en hommage à Hans Hagen.
\stopitemize
\stopDemoHN}

\stopsubsection

% *** Subsection 
\startsubsection
  [
    reference=sec:itemize_arg1,
    title={Configuration basique des listes},
  ]

Nous rappelons que \MyKey{itemize} permet deux arguments. Nous avons déjà vu comment le premier argument nous permet de sélectionner le type de liste que nous voulons. Mais nous pouvons également l'utiliser pour indiquer d'autres caractéristiques de la liste ; ceci est fait par les options suivantes pour \MyKey{itemize} dans son premier argument :

\startitemize

\item {\tt columns} : cette option détermine que la liste est composée de deux colonnes ou plus. Après l'option colonnes, le nombre de colonnes souhaité doit être écrit sous forme de mots séparés par une virgule : {\tt two, three, four, five, six, seven, eight or nine}. {\tt columns} non suivi d'un nombre quelconque génère deux colonnes.

\item {\tt intro} : cette option tente de ne pas séparer la liste, par un saut de ligne, du paragraphe qui la précède.  

\item {\tt continue} : dans les listes ordonnées (numériques ou alphabétiques), cette option permet à la liste de poursuivre la numérotation à partir de la dernière liste numérotée. Si l'option {\tt continue} est utilisée, il n'est pas nécessaire d'indiquer le type de liste que l'on souhaite, car on suppose qu'elle sera identique à la dernière liste numérotée.

\item {\tt packed} : est l'une des options les plus utilisées. Son utilisation permet de réduire au maximum l'espace vertical entre les différents {\em items} de la liste.

\item {\tt nowhite} produit un effet similaire à celui de {\tt packed}, mais plus radical : il réduit non seulement l'espace vertical entre les éléments, mais aussi l'espace vertical entre la liste et le texte environnant.

\placefigure [force,here,none] [] {}
{\startDemoVN
Texte introductif.
\startitemize[packed]
\item Premier élément
\item Second élément
\item Troisième élément
\stopitemize
Texte introductif.
\startitemize[nowhite]
\item Premier élément
\item Second élément
\item Troisième élément
\stopitemize
Texte introductif.
\stopDemoVN}

\item {\tt after, before:} rajoutent au contraire des espaces respectivement après ou avant la liste

\placefigure [force,here,none] [] {}
{\startDemoVN
Texte introductif.
\startitemize[nowhite,after]
\item Premier élément
\item Second élément
\item Troisième élément
\stopitemize
Texte introductif.
\startitemize[nowhite,before]
\item Premier élément
\item Second élément
\item Troisième élément
\stopitemize
Texte introductif.
\stopDemoVN}

\item {\tt joinedup :} assure le rôle de {\tt nowhite} mais entre un niveau d'item et son parent dans le cas de listes imbriquées.

\placefigure [force,here,none] [] {}
{\startDemoVW%
\setupitemgroup[itemize] [1] [nowhite]%
\setupitemgroup[itemize] [2] [nowhite]%
\startitemize  
\item item 1.1
\startitemize
\item item 2.1 \item item 2.2
\stopitemize   
\item item 1.2
\stopitemize

\setupitemgroup[itemize] [1] [joinedup]%
\startitemize  
\item item 1.1
\startitemize
\item item 2.1 \item item 2.2
\stopitemize   
\item item 1.2
\stopitemize
\stopDemoVW}



\item {\tt broad} : augmente l'espace horizontal entre le séparateur d'élément et le texte de l'élément. L'espace peut être augmenté en multipliant un nombre par {\tt broad} comme dans, par exemple : \type{\startitemize[2*broad]}.

\placefigure [force,here,none] [] {}
{\startDemoVN
\startitemize[packed,2*broad]
\item Premier élément
\item Second élément
\stopitemize
\stopDemoVN}

\item {\tt serried} : supprime l'espace horizontal entre le séparateur d'élément et le texte.

\item {\tt intext} : supprime le retrait suspendu.

\item {\tt text} : supprime le retrait suspendu et réduit l'espace vertical entre les éléments.

\item {\tt repeat} : dans les listes imbriquées, la numérotation d'un niveau enfant {\em repeat} devient le même niveau que le niveau précédent. Ainsi, nous aurions, au premier niveau : 1, 2, 3, 4 ; au deuxième niveau : 1.1, 1.2, 1.3, etc. L'option doit être indiquée pour la liste intérieure, pas pour la liste extérieure.

\item {\tt margin, inmargin} : par défaut, le séparateur de liste est imprimé à gauche, mais à l'intérieur de la zone de texte elle-même ({\tt atmargin}). Les options {\tt margin} et {\tt inmargin} permettent de déplacer le séparateur vers la marge.

\stopitemize

\stopsubsection

% *** Subsection 
\startsubsection
  [
    reference=sec:itemize_arg2,
    title={Configuration complémentaire des listes},
  ]

Le deuxième argument, également facultatif, de \tex{startitemize} permet une configuration plus détaillée et plus approfondie des listes.

\startitemize

\item {\tt before, after} : commandes à exécuter respectivement avant le démarrage ou après la fermeture de l'environnement itemize (à ne pas confondre avec ces options de l'argument 1, qui font référence aux espacements verticaux voir ci-dessus).

\item {\tt inbetween} : commande à exécuter entre deux {\tt items}.

\item {\tt beforehead, afterhead} : commande à exécuter avant ou après un élément saisi avec la commande \tex{head}.

\item {\tt left, right} : caractère à imprimer à gauche ou à droite du séparateur. Par exemple, pour obtenir des listes alphabétiques dans lesquelles les lettres sont entourées de parenthèses, il faudrait écrire \tex{startitemize[a][left=(, right=)]}

\item {\tt stopper} : indique un caractère à écrire après le séparateur. Ne fonctionne que dans les listes ordonnées.

\item {\tt width, maxwidth} : largeur de l'espace réservé au séparateur et donc au retrait suspendu.

\item {\tt factor} : nombre représentatif du facteur de séparation entre le séparateur et le texte.

\item {\tt distance} : mesure de la distance entre le séparateur et le texte.

\placefigure [force,here,none] [] {}
{\startDemoVW%
\setupitemgroup[itemize]   [1]
               [nowhite,joinedup,3*broad]%
\setupitemgroup[itemize]   [2]
               [nowhite] [width=5mm]%
\startitemize  
\item item 1.1
\startitemize
\item item 2.1 \item item 2.2
\stopitemize   
\item item 1.2
\stopitemize
\setupitemgroup[itemize] [1] [distance=5mm]%
\setupitemgroup[itemize] [2] [distance=5mm]%
\startitemize  
\item item 1.1
\startitemize
\item item 2.1 \item item 2.2
\stopitemize   
\item item 1.2
\stopitemize
\stopDemoVW}


\item {\tt leftmargin, rightmargin, margin} : marge à ajouter à gauche (leftmargin) ou à droite (rightmargin) des éléments. 



\item {\tt start} : numéro à partir duquel la numérotation des éléments commencera.

\item {\tt symalign, itemalign, align} : alignement des éléments. Permet les mêmes valeurs que \tex{setupalign}. {\tt symalign} contrôle l'alignement du séparateur, {\tt itemalign} celui du texte de l'élément et {\tt align} contrôle les deux.

\item {\tt identing} : indentation de la première ligne des paragraphes
à l'intérieur de l'environnement. Voir \in{section}[sec:indentation].

\item {\tt indentnext} : indique si le paragraphe suivant l'environnement doit être indenté ou non. Les valeurs sont {\em yes, no} et {\tt auto}.

\item {\tt items} : dans les éléments saisis en entrée avec \tex{its}, indique le nombre de fois que le séparateur doit être reproduit.

\item {\tt style, color ; headstyle, headcolor ; marstyle, marcolor ; symstyle, symcolor} : ces options contrôlent le style et la couleur des éléments lors de leur saisie dans l'environnement avec les commandes \tex{item}, \tex{head}, \tex{mar} ou \tex{sym}.

\stopitemize

\stopsubsection

% *** Subsection 
\startsubsection
  [
    reference=sec:items command,
    title={Listes simples à l'aide de la commande \tex{items}.},
  ]

\PlaceMacro{items}

Une alternative à l'environnement {\tt itemize} pour les listes non numérotées très simples, où les éléments ne sont pas trop gros, est la commande \tex{items} dont la syntaxe est :

\placefigure [force,here,none] [] {}
{\startDemoI
\items[Configuration]{Item 1, Item 2, ..., item n}
\stopDemoI}

Les différents éléments de la liste sont séparés les uns des autres par des virgules. Par exemple :

\placefigure [force,here,none] [] {}
{\startDemoVN
Les fichiers graphiques peuvent avoir, entre autres, les extensions suivantes :
\items{png, jpg, tiff, bmp}
\stopDemoVN}

Les options de configuration prises en charge par cette commande sont un sous-ensemble de celles de la commande {\tt itemize}, à l'exception de deux options spécifiques à cette commande : 

\startitemize
  
\item {\tt symbol} : cette option détermine le type de liste qui sera généré. Elle prend en charge les mêmes valeurs que celles utilisées pour {\tt itemize} pour sélectionner un type de liste.
 
\item {\tt n} : cette option indique à partir de quel numéro d'élément il y aura un séparateur.

\stopitemize

\stopsubsection

% *** Subsection 
\startsubsection
  [
    reference=sec:setupitemize,
    title={Prédétermination du comportement des listes et création de nos propres types de listes},
  ]
  
Dans les sections précédentes, nous avons vu comment indiquer quel type de liste nous voulons et quelles caractéristiques elle doit avoir. Mais faire cela à chaque fois qu'une liste est appelée est inefficace et produira généralement un document incohérent dans lequel chaque liste a sa propre apparence, mais sans que les différentes apparences ne répondent à aucun critère.

Résultat préférable pour cela :

\startitemize

\item Prédéterminer le comportement {\em normal} de {\tt itemize} et \tex{items} dans le préambule du document.

\item Créer nos propres listes personnalisées. Par exemple : une liste numérotée alphabétiquement que nous voulons appeler {\em ListAlpha}, une liste numérotée avec des chiffres romains ({\em ListRoman}), etc.
 
\stopitemize

Nous réalisons la première avec les commandes \tex{setupitemize} et \tex{setupitems}. La seconde nécessite l'utilisation de la commande \PlaceMacro{defineitemgroup} \tex{defineitemgroup}, ou \PlaceMacro{defineitems} \tex{defineitems}. La première créera un environnement de liste similaire à {\tt itemize} et la seconde une commande similaire à {\tt items}.

\stopsubsection

\stopsection

% ** Section 
\startsection
  [title={Descriptions et énumerations}]

Les descriptions et les énumérations sont deux constructions qui permettent la composition cohérente de paragraphes ou de groupes de paragraphes qui développent, décrivent ou définissent une phrase ou un mot.

% *** Subsection          <<<<<<<<<<<<<<<<<
\startsubsection
  [title={Descriptions}]

For descriptions we differentiate between a {\em title} and its explanation or development. We can create a new description with:

\PlaceMacro{definedescription}\type{\definedescription [Name] [Configuration]}

where {\em Name} is the name by which this new construction will be known, and Configuration controls what our new structure will look like. After the previous statement we will have a new command and an environment with the name we have chosen. Thus:

\type{\definedescription [Concept]}

will create the commands:

\starttyping
  \Concept{Title}
  \startConcept {Title} ... \stopConcept
\stoptyping

We will use the command for the case where the explanatory text of the title consists of only one paragraph, and the environment for titles whose description occupies more than one paragraph. When the command is used, the paragraph immediately following it is the one that will be considered the title's explanatory text. But when the environment is used, all content will be formatted with the appropriate indentation to make it clear how it relates to the title.

For example:

\starttyping
\definedescription
  [Concept]
  [alternative=left, width=1cm, headstyle=bold]

\Concept{Contextualise}

Place something in a certain context, or typeset a text with the typesetting system called \ConTeXt. The ability to correctly contextualise in any situation is considered a sign of intelligence and good sense.

\stoptyping

This will generate the following result:

\startcolor[red]

\definedescription
  [Concept]
  [alternative=left, width=3cm, headstyle=bold]

\Concept{Contextualise}

Place something in a certain context, or typeset a text with the typesetting system called \ConTeXt. The ability to correctly contextualise in any situation is considered a sign of intelligence and good sense.
  
\stopcolor

As is normally the case with \ConTeXt, the appearance that our new construction will have can be indicated at the time of its creation, with the {\em Configuration} argument or later on with \tex{setupdescription}:

\PlaceMacro{setupdescription}\type{\setupdescription [Name] [Configuration]}

where {\em Name} is the name of our new description, and {\em Configuration} determines what it looks like. Among the different possible configuration options I will highlight:

\startitemize

\item {\tt alternative}: This option is the one that fundamentally controls the appearance of the construction. It determines the placement of the title in relation to its description. Its possible values are {\tt left, right, inmargin, inleft, inright, margin,  leftmargin, rightmargin, innermargin, outermargin, serried, hanging}, their names are clear enough to get an idea of the result, although, in case  of doubt, it is best to do a test to see how it looks.

\item {\tt width}: controls the width of the box in which the title will be written. Depending on the value of {\tt alternative} that distance will also be part of the indentation with which the explanatory text is written.

\item {\tt distance}: controls the distance between the title and the explanation.

\item {\tt headstyle, headcolor, headcommand}: affect how the title itself will look: Style ({\tt headstyle}) and color ({\tt headcolor}). With headcommand we can indicate a command to which the title text will be passed as an argument. For example: {\tt headcommand=\backslash WORD} will make sure that the title text is all in upper case.

\item {\tt style, color}: controls the appearance of the title's descriptive text.

\stopitemize

\stopsubsection

% *** Subsection 
\startsubsection
  [title={Enumerations}]

Enumerations are numbered text elements structured on several levels. Each element starts with a title that consists, by default, of the name of the structure and its number, although we can change the title with the {\tt text} option. They are quite similar to descriptions, although they differ in that:

\startitemize

\item All the elements in an enumeration share the same title.

\item Therefore they differ from each other by their numbering.  

\stopitemize

This structure can be very useful, for example, to write formulas, problems or exercises in a textbook, ensuring that they are numbered correctly and formatted in a consistent manner.

We create an enumeration with

\PlaceMacro{defineenumeration}\type{\defineenumeration [Name] [Configuration]}

where {\em Name} is the name of the new construction, and {\em Configuration} controls what it will look like. 

So, in the following example:

\starttyping
  \defineenumeration
    [Exercise]
    [alternative=top, before=\blank, after=\blank, between=\blank]
\stoptyping

We have created a new structure called {\em Exercise} and, as happens with enumerations, we will have  the following new commands available:

\starttyping
  \Exercise
  \startExercise
\stoptyping

The command is used just for a single paragraph {\em exercise}, and the environment for multiple paragraph {\em exercises}. But since enumerations can be up to four levels deep, the following commands and environments will also be created:

\starttyping
  \subExercise
  \startsubExercise
  \stopsubExercise
  \subsubExercise
  \startsubsubExercise
  \stopsubsubExercise
  \subsubsubExercise
  \startsubsubsubExercise
  \stopsubsubsubExercise
\stoptyping

And, to control the numbering, the following additional commands:

\startitemize

\item \tex{setEnumerationName}: sets the current numbering value.

\item \tex{resetEnumerationame}: sets the enumeration counter to zero.

\item \tex{nextEnumerationName}: increases the enumeration counter by one.

\stopitemize

The appearance of enumerations can be determined at the time of their creation or later with \tex{setupenumeration} whose format is:

\PlaceMacro{setupenumeration}\type{\setupenumeration [Name] [Configuration]}.

For each enumeration we can configure each of its levels separately. Thus, for example, \tex{setupenumeration [subExercise] [Configuration]} will affect the second level of the enumeration called \quotation{Exercise}.

The options and values configurable with \tex{setupenumeration} are similar to those in \tex{setupdescription}.

\stopsubsection

\stopsection

% ** Section
\startsection
  [
    reference=sec:FramesLines,
    title={Lines and frames},
  ]

It says in the\ConTeXt\ reference manual that \TeX\ has a huge text management capability, but is very weak in managing graphic information. I beg to differ: it is true that for handling lines and frames the possibilities of \ConTeXt\ (actually \TeX) are not as overwhelming as when it comes to typesetting text. But to go on to say that the system is weak in this regard is, I think, somewhat of a stretch. I don't know of any function with lines and frames that  other typesetting systems can do for documents that \ConTeXt\ is unable to generate. And if we combine \ConTeXt\ with MetaPost, or with TiKZ (\ConTeXt\ has an expansion module for this), then the possibilities are only limited by our imagination.

In the following sections, however, I will limit myself to explaining how to generate simple horizontal and vertical lines and frames around words, sentences or paragraphs.

% *** Subsection 
\startsubsection
  [title={Simple lines}]

The simplest way of drawing a horizontal line is with the \PlaceMacro{hairline}\tex{hairline} command that generates a horizontal line that occupies all the width of a normal text line.

There cannot be text of any kind on the line where the line generated by \tex{hairline} is. In order to generate a line capable of coexisting with the text on the same line, we need the \PlaceMacro{thinrule}\tex{thinrule} command. This second command will use the full width of the line. Therefore, in an isolated paragraph, it will have the same effect as \tex{hairline}, while in the opposite case, \tex{thinrule} will produce the same horizontal expansion as \tex{hfill} (see \in{section}[sec:horizontal space2]), but instead of filling the horizontal space with white space (as \tex{hfill} does), it fills it with a line.

\startDoubleExample
\starttyping
On the left\thinrule\\
\thinrule On the right\\
On both\thinrule sides\\
\thinrule centred\thinrule
\stoptyping

On the left\thinrule\\
\thinrule On the right\\
On both\thinrule sides\\
\thinrule centred\thinrule

\stopDoubleExample

With the \PlaceMacro{thinrules}\tex{thinrules} command we can generate several lines. For example \tex{thinrules[n=2]} will generate two consecutive lines, each the width of the normal line. The lines generated with \tex{thinrules} can also be configured, either in an actual call to the command, indicating the configuration as one of its arguments, or generally with \tex{setupthinrules}. Configuration includes the thickness of the line ({\tt rulethickness}), its colour ({\tt color}), background colour ({\tt background}), interline space ({\tt interlinespace}), etc.

\startSmallPrint

  I will leave a number of options without explanation. The reader can consult them in {\tt setup-en.pdf} (see \in{section}[sec:qrc-setup-en]). Some options only differ from others in terms of nuance (i.e there is hardly any difference between them), and I think it is faster for the reader to try to {\em see} the difference, than for me to try to convey it in words. For example: the thickness of the line I just said depends on the {\tt rulethickness} option. But it is also affected by the {\tt height} and {\tt depth} options.

\stopSmallPrint

Smaller lines can be generated with the \PlaceMacro{hl}\tex{hl} and \PlaceMacro{vl}\tex{vl} commands. The first generates a horizontal line and the second a vertical line. Both take a number as a parameter that allows us to calculate the length of the line. In \tex{hl} the number measures the length in {\em ems} (no need to indicate the unit of measurement in the command) and in \tex{vl} the argument refers to the current height of the line.

Thus \tex{hl[3]} generates a horizontal line of 3 ems and \tex{vl[3]} generates a vertical line of the height corresponding to three lines. Remember that the line measurement indicator must be inserted between square brackets, not between curly brackets. In both commands the argument is optional. If it is not entered, a value of 1 is assumed.

\PlaceMacro{fillinline}\tex{fillinline} is another command to create horizontal lines of precise length. It supports more configuration in which we can indicate (or predetermine with \PlaceMacro{setupfillinlines}\tex{setupfillinlines}) the width ({\tt width} option) in addition to some other features.

A peculiarity of this command is that text that is written to its right will be placed on the left of the line, separating that text from the line by the necessary white space to occupy the whole line. For example:

\starttyping
\fillinline[width=6cm] Name    
\stoptyping

will generate

\startcolor[red]
  
\fillinline[width=6cm] {Name}

\stopcolor

\startSmallPrint

  I suspect that this strange operation is due to the fact that this macro was designed to write forms where there is a horizontal line behind the text on which something \Conjecture must be written. In fact the very name of the command {\tt fillinline} means, fill in the line.

\stopSmallPrint

Besides the width of the line, we can configure the margin ({\tt margin}), the distance ({\tt distance}), the thickness ({\tt rulethickness}) and the colour ({\tt color}).

Almost identical to \tex{fillinline} is \tex{fillinrules}, although this command allows us to insert more than one line ( \MyKey{n} option).

\type{\fillinrules [Configuration] {Text} {Text}}

where the three arguments are optional.

\stopsubsection

% *** Subsection 
\startsubsection
  [title={Lines linked to text}]

Although some of the commands we have just seen can generate lines that coexist with text on the same line, those commands actually focus on the line's layout. To write lines linked to certain text, \ConTeXt\ has commands:

\startitemize

\item that generate text between lines.

\item that generate lines under the text (underlining), above the text (overlining) or through it (strikethrough).

\stopitemize

To generate a text between lines the usual command is \PlaceMacro{textrule}\tex{textrule}. This command draws a line that crosses the entire width of the page and writes the text it takes as a parameter on the left side (but not at the margin). For example:

\startDoubleExample
\starttyping
\textrule{Example text}
\stoptyping
\ 

\textrule{Example text}

\stopDoubleExample

\startSmallPrint

  It is assumed that \tex{textrule} allows an optional first argument with three possible values: {\tt top}, {\tt middle} and \Doubt{\tt bottom}. But, after some tests, I have not been able to find out what effect such options produce.

\stopSmallPrint

Similar to \tex{texrule} is the \PlaceMacro{starttextrule}\tex{starttextrule} environment which, besides inserting the line with text at the beginning of the environment, inserts a horizontal line at the end. The format of this command is:

\type{\starttextrule[Configuration]{Text on the line} ... \stoptextrule} %

Both \tex{textrule} and \text{starttextrule} can be configured with \PlaceMacro{setuptextrule}\tex{setuptextrule}.

To draw lines under, over, or through text, the following commands are used:

\PlaceMacro{underbar}\PlaceMacro{underbars}\PlaceMacro{overbar}
\PlaceMacro{overbars}\PlaceMacro{overstrike}\PlaceMacro{overstrikes}
\starttyping
  \underbar{Text}
  \underbars{Text}
  \overbar{Text}
  \overbars{Text}
  \overstrike{Text}
  \overstrikes{Text}
\stoptyping

As we can see, for each type of line (under, over, or through text) there are two commands. The singular version of the command draws a single line under, over or through all the text taken as an argument, while the plural version of the command only draws the line over the words, but not the white space.

These commands are not compatible with each other, that is to say, two of them cannot be applied to the same text. If we try, the last one will always prevail. On the other hand \tex{underbar} can be nested, underlining what has already been underlined.

\startSmallPrint

  The reference manual points out that \tex{underbar} disables hyphenation of words in the text that constitute its argument. It is not clear to me whether that statement refers only to \tex{underbar} or to the six commands we are examining.

\stopSmallPrint

\stopsubsection

% *** Subsection 
\startsubsection
  [title={Framed words or texts}]

To surround a text with a frame or grid we use:

\startitemize

\item The \PlaceMacro{framed}\tex{framed} or \PlaceMacro{inframed}\tex{inframed} commands if the text is relatively brief and does not take up more than one line.

\item The \PlaceMacro{startframedtext}\tex{startframedtext} environment for longer texts.

\stopitemize

The difference between \tex{framed} and \tex{inframed} lies at the point from which the frame is drawn. In \tex{frame} the frame is drawn upwards from an ideal line, called a baseline, on which the letters rest, but certain letters pass downwards. In \tex{inframed} the frame is drawn, also upwards, from the lowest possible point on the line. For example:

\startDoubleExample
\starttyping
Here there are \framed{two} good
\inframed{frames}.
\stoptyping

Here there are \framed{two} good
\inframed{frames}.

\stopDoubleExample

Both, framed and inframed text, can be customized with \PlaceMacro{setupframed}\tex{setupframed}, and \tex{startframedtext} is customized with \PlaceMacro{setupframedtext}\tex{setupframedtext}. The customization option for both commands are quite similar. They allow us to indicate the measurements of the frame ({\tt height, width, depth}), the shape of the corners ({\tt framecorner}), which can be {\tt rectangular} or round ({\tt round}), the frame colour ({\tt framecolor}), the line thickness ({\tt framethickness}), the alignment of content ({\tt align}), text colour ({\tt foregroundcolor}), background colour ({\tt background} and {\tt backgroundcolor}), etc.

For \tex{startframedtext} there is also an apparently strange property: {\tt frame=off} that causes the frame not to be drawn (although it is still there, but invisible). This property exists because since the frame around a paragraph is indivisible, it is common for the entire paragraph to be enclosed in a {\tt framedtext} environment with the frame drawing option turned off, to ensure that no page breaks are inserted within a paragraph.

We can also create a customized version of these commands with \PlaceMacro{defineframed}\tex{defineframed} and \PlaceMacro{defineframedtext}\tex{defineframedtext}.

\stopsubsection

\stopsection

% ** Section
\startsection
  [
    reference=sec:buffer,
    title={Other environments and constructions of interest},
  ]

  There are still many environments in \ConTeXt\ that I have not even mentioned, or only very much in passing. By way of example:

\startitemize
  
\item {\tt\bf buffer}\PlaceMacro{startbuffer}\PlaceMacro{getbuffer} {\em Buffers} are text fragments stored in memory for later re-use. A {\em buffer} is defined somewhere in the document with \cmd{startbuffer[BufferName] ... \backslash stopbuffer} and can be retrieved as often as desired at some other point in the document with  \tex{getbuffer[BufferName]}.

\item {\tt\bf chemical}\PlaceMacro{startchemical}
  This environment allows us to place chemical formulas inside it. If \TeX\ stands out, among many other things, for its ability to typeset texts with mathematical formulas properly, from the outset \ConTeXt\ sought to extend this ability to chemical formulas, and it has this environment where commands and structures are enabled for writing chemical formulas.

\item {\tt\bf combination}\PlaceMacro{startcombination}
  This environment allows us to combine several floating elements on the same page. It is particularly useful for aligning different connected external images in our document.

\item {\tt\bf formula}\PlaceMacro{startformula}
  This is an environment aimed at typesetting maths formulas.

\item {\tt\bf hiding}\PlaceMacro{starthiding}
  The text stored in this environment will not be compiled and will not appear, therefore, in the final document. This is useful for temporarily disabling compilation of certain fragments in the source file. The same thing is achieved by marking one or more lines as a comment. But when the fragment we want to disable is relatively long, more effective than marking tens or hundreds of lines of the source file as a comment is to insert the \tex{starthiding} command at the beginning of the fragment, and \tex{stophiding} at the end. 

\item {\tt\bf legend}\PlaceMacro{startlegend}
  In a mathematical context, \TeX\ applies different rules so that no normal text can be written. However, sometimes a formula is accompanied by a description of the elements used in it. For this purpose there is the \tex{startlegend} environment which allows us to place normal text in a mathematical context.

\item {\tt\bf linecorrection}\PlaceMacro{startlinecorrection}
  Usually, \ConTeXt\ correctly manages the vertical space between lines, but occasionally a line may contain something that makes it not look right. This happens mainly with lines that have fragments framed with \tex{framed}. In such cases this environment adjusts the line spacing so that the paragraph appears correctly.

\item {\tt\bf mode}\PlaceMacro{startmode}
  This environment is intended to include fragments in the source file that will only be compiled if the appropriate mode is active. The use of {\em modes} is not the subject of this introduction, but it is a very interesting tool if we want to be able to generate several versions with different formats, from a single source file. A complementary environment to this one is \PlaceMacro{startnotmode}\tex{startnotmode}.

\item {\tt\bf opposite}\PlaceMacro{startopposite}
  This environment is used to typeset texts when the contents of the left and right pages are related.

\item {\tt\bf quotation}\PlaceMacro{startquotation}
  A very similar environment to {\tt narrower}, intended to insert moderately long literal quotations. The environment makes sure that the text inside is quoted, and that the margins are increased so that the paragraph with the quotation stands out visually on the page. But it should be noted that according to usual blockquote style in English, there should be no opening and closing quotation marks -- which makes this command or environment less useful.

\item {\tt\bf standardmakeup}\PlaceMacro{startstandardmakeup}
  This environment is designed to generate pages with the title of the document, which is relatively common in academic documents of a certain length, such as doctoral theses, master's theses, etc.

\stopitemize

To learn about any of these environments (or others I have not mentioned), I suggest the following steps:

\startitemize[n]

\item Look for information on the environment in the \ConTeXt\ reference manual. This manual does not mention all the environments; but it does say something about every item in the list above.

\item Write a test document where the environment is used.

\item Look up \ConTeXt's official list of commands (see \in{section}[sec:qrc-setup-en]) for the configuration options for the environment in question, then test them to see exactly what they do.
  
\stopitemize

% * END 
\stopchapter

\stopcomponent

%%% Local Variables:
%%% mode: ConTeXt
%%% mode: auto-fill
%%% coding: utf-8-unix
%%% TeX-master: "../introCTX_fra.tex"
%%% End:
%%% vim:set filetype=context tw=75 : %%%
